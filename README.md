# Ansible Project Scaffolder Setup

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Bash Shell](https://shields.io/badge/shell-bash-blue?logo=gnu-bash&logoColor=white)](https://www.gnu.org/software/bash/)
[![Ansible Compatible](https://img.shields.io/badge/Ansible-Compatible-red?logo=ansible)](https://www.ansible.com/)

A professional Bash script designed to rapidly scaffold a complete Ansible project structure. It's built to help both beginners and experienced DevOps engineers automate the installation of basic services on Linux and Windows hosts, promoting best practices and a modular project layout.

## Overview

Starting a new Ansible project often involves the repetitive setup of directories, configuration files, and basic role structures. This script automates that initial bootstrapping process, allowing you to focus on writing automation logic faster. It interactively prompts for host information, desired services, and connection security preferences, then generates a well-documented, ready-to-edit Ansible project.

This tool is particularly useful for:
* Quickly setting up new Ansible projects for different environments.
* Ensuring a consistent and standard project structure across teams.
* Beginners looking to understand a typical Ansible project layout and best practices.
* Rapidly deploying common services in lab, development, or testing environments.

## Key Features

* **Automated Project Scaffolding**: Creates a comprehensive Ansible directory structure (`inventory`, `roles`, `playbooks`, `group_vars`, `host_vars`, `templates`).
* **Cross-Platform Support**: Generates configurations for managing both Linux (via SSH) and Windows (via WinRM) hosts.
* **Interactive Setup**: Prompts for host details, OS types, and services to be installed.
* **Service-Specific Role Generation**: Creates minimal role structures for selected services with TODOs and example task comments.
    * **Linux Services Supported**: `apache2`, `bind9`, `haproxy`.
    * **Windows Services Supported**: `dns`, `webserver` (for IIS).
* **Secure Connection Options**:
    * Prompts user to choose between secure (SSH for Linux, WinRM over HTTPS for Windows) or insecure (WinRM over HTTP for Windows) connections.
    * Includes clear warnings and guidance for insecure setups.
    * Dynamically adjusts Ansible configuration (`ansible.cfg`, inventory variables) based on the security choice.
* **Jinja2 Template Integration**: Supports importing user-provided Jinja2 templates from an external `jinja2-templates/` directory into the project for configuration management.
* **Configuration File Generation**: Creates a basic `ansible.cfg`, an inventory file (`inventory/hosts.ini`), and a main playbook (`playbooks/main.yml`).
* **Auto-Generated Documentation**: Creates a `README.md` within the generated Ansible project with specific usage instructions for that project.
* **Beginner-Friendly**: Designed to lower the entry barrier for Ansible by providing a structured and commented starting point.

## Requirements

To use this scaffolding script:

1.  **Bash Shell**: A compatible Bash environment.
    * **Linux/macOS**: Typically pre-installed.
    * **Windows**: Use Windows Subsystem for Linux (WSL), Git Bash, or Cygwin.
2.  **(Optional but Recommended) Ansible**: Ansible should be installed on your control node (the machine where you'll run Ansible commands) to test and run the playbooks generated by this script.
    * See the [Official Ansible Installation Guide](https://docs.ansible.com/ansible/latest/installation_guide/index.html).
3.  **(Optional) Jinja2 Templates Source Directory**: If you plan to use custom configuration templates for services:
    * Create a directory named `jinja2-templates/` in the **same directory where you will run the `generate-ansible-project.sh` script.**
    * Place your Jinja2 template files (e.g., `apache2.j2`, `iis.j2`, `dns_win.j2`) inside this `jinja2-templates/` directory. The script will copy relevant templates into the generated Ansible project's `templates/` folder.

## How to Use the Scaffolding Script

1.  **Clone or Download the Script**:
    ```bash
    # If this script is part of a Git repository:
    # git clone [https://github.com/your-username/your-repo-name.git](https://github.com/your-username/your-repo-name.git)
    # cd your-repo-name/
    #
    # Or, if you just have the script file:
    # Ensure generate-ansible-project.sh is in your current directory.
    ```

2.  **Make the Script Executable**:
    ```bash
    chmod +x generate-ansible-project.sh
    ```

3.  **(Optional) Prepare Jinja2 Templates Source**:
    If you have service configuration templates, create the `jinja2-templates/` directory alongside the script and populate it:
    ```
    .
    ├── generate-ansible-project.sh  <-- Your script
    └── jinja2-templates/            <-- Your Jinja2 templates source
        ├── apache2.j2
        ├── bind9.j2
        ├── dns_win.j2
        ├── haproxy.j2
        └── iis.j2
    ```

4.  **Run the Script**:
    Execute the script from your terminal:
    ```bash
    ./generate-ansible-project.sh
    ```

5.  **Follow the Interactive Prompts**:
    The script will guide you through:
    * Choosing secure or insecure connection protocols.
    * Entering a list of hostnames (e.g., `LIN1, WINSERV, web01`).
    * Defining the OS type (Linux/Windows) for each host.
    * Selecting services to install on each host from the available options.

Upon completion, a new directory named `ansible-project/` (this is the default project name) will be created in the current location, containing the scaffolded Ansible project.

## Generated Ansible Project Structure

The script generates the following structure within the `ansible-project/` directory:
```
ansible-project/├── ansible.cfg             # Main Ansible configuration for this project.│                           # Defines inventory path, roles path, default connection settings,│                           # host key checking, and privilege escalation.├── inventory/│   └── hosts.ini           # Default inventory file. Defines host groups (e.g., [linux_hosts],│                           # [windows_hosts]) and host-specific connection variables│                           # (especially for WinRM).├── group_vars/             # Directory to store variables applicable to entire host groups.│                           # Example: group_vars/linux_hosts.yml or group_vars/all.yml. (Created empty)├── host_vars/              # Directory to store variables specific to individual hosts.│                           # Example: host_vars/server1.example.com.yml. (Created empty)├── playbooks/│   └── main.yml            # The main playbook that orchestrates the deployment by applying│                           # roles to the defined host groups.├── roles/                  # Contains all the Ansible roles for service management.│   └── _/     # Each selected service gets its own role directory (e.g., roles/linux_apache2/).│       ├── tasks/main.yml    # Core tasks for installing and configuring the service.│       │                     # Contains placeholders and TODO comments.│       ├── handlers/main.yml # Handlers triggered by tasks (e.g., to restart a service).│       ├── templates/        # Directory for role-specific Jinja2 templates.│       ├── vars/main.yml     # Variables specific to this role (higher precedence than defaults).│       ├── defaults/main.yml # Default variables for the role (lowest precedence, easily overridden).│       └── meta/main.yml     # Role metadata, including dependencies and platform support.├── templates/                # Project-level Jinja2 templates. These are copied from your│                           # external jinja2-templates/ source directory if they were│                           # selected based on the services you chose.└── README.md               # A specific README for the generated Ansible project,# detailing its structure and how to use it.
```
## Using the Generated Ansible Project

Once the `ansible-project/` directory is generated:

1.  **Navigate to the Project Directory**:
    ```bash
    cd ansible-project
    ```

2.  **Review and Customize (Crucial Steps!)**:
    * **Inventory (`inventory/hosts.ini`):**
        * Verify hostnames. Replace placeholders with actual FQDNs or IP addresses if you used generic names.
        * Adjust connection variables per host if defaults are not suitable (e.g., `ansible_user`, `ansible_ssh_private_key_file`). For passwords, **use Ansible Vault**.
    * **Variables (`group_vars/`, `host_vars/`, `roles/*/defaults/main.yml`, `roles/*/vars/main.yml`):**
        * Define service-specific configurations, user accounts, ports, etc.
        * Use `group_vars/` for settings common to a group of hosts.
        * Use `host_vars/` for settings unique to a single host.
        * Role defaults (`roles/*/defaults/main.yml`) are a good place for general settings that can be easily overridden.
    * **Roles (`roles/`):**
        * This is where the core automation logic resides.
        * Edit `tasks/main.yml` within each role. **Fill in the `TODO` sections** and implement the actual steps to install, configure, and manage the services. The generated files provide a starting point and comments.
        * If you're using templates (e.g., for configuration files), ensure they are correctly placed in the project's `templates/` directory (or a role's specific `templates/` sub-directory) and referenced correctly in your tasks (e.g., `src: ../../templates/your_template.j2` if a role task refers to a project-level template).
    * **Playbook (`playbooks/main.yml`):**
        * Review how roles are applied to host groups. Modify if you need a different order or conditional application.

3.  **(Windows Hosts Only) Configure WinRM**:
    Ansible communicates with Windows hosts using Windows Remote Management (WinRM). Ensure it's enabled and configured on your Windows targets.
    * The `ansible-project/README.md` (generated inside your new project) will contain specific instructions based on whether you chose a secure (HTTPS) or insecure (HTTP) WinRM setup.
    * **For secure WinRM (HTTPS)**: Requires an SSL certificate on the Windows host for the WinRM listener.
    * **For insecure WinRM (HTTP)**: Requires allowing unencrypted traffic and basic authentication on the Windows host.

4.  **Run the Ansible Playbook**:
    From within the `ansible-project/` directory:
    ```bash
    # Check playbook syntax
    ansible-playbook playbooks/main.yml --syntax-check

    # Perform a dry run (shows what changes would be made without actually making them)
    ansible-playbook playbooks/main.yml --check

    # Execute the playbook to apply configurations
    ansible-playbook playbooks/main.yml

    # To run against a specific group or host:
    # ansible-playbook playbooks/main.yml --limit linux_hosts
    # ansible-playbook playbooks/main.yml --limit your_specific_hostname

    # If your SSH user requires a sudo password or WinRM user password is not in vars:
    # ansible-playbook playbooks/main.yml --ask-become-pass  (for sudo on Linux)
    # ansible-playbook playbooks/main.yml --ask-pass         (for SSH/WinRM password)
    ```

## ⚠️ Security Warning: Insecure Connection Setup

If you chose **insecure connections** during the script setup:

* **General Warning**: Using unencrypted connections is **NOT recommended for production environments**. This option should only be used in controlled lab or testing environments where risks are understood and accepted.
* **For Windows (WinRM over HTTP)**:
    * The script will configure Ansible to use WinRM over HTTP (default port 5985).
    * Credentials (if using Basic authentication) and all data exchanged with the Windows host will be sent in **plain text**.
    * You **must** configure the target Windows Servers to allow unencrypted traffic (`AllowUnencrypted = true`) and enable Basic authentication (`Basic = true`) in the WinRM service configuration. The `ansible-project/README.md` (generated by the script) will contain example PowerShell commands for this.
* **For Linux (SSH)**:
    * While SSH itself is an encrypted protocol, the generated `ansible.cfg` sets `host_key_checking = False`. This bypasses SSH host key verification, making connections vulnerable to Man-In-The-Middle (MITM) attacks. For production environments, set this to `True` and manage your `~/.ssh/known_hosts` file or use an SSH CA.

**Always prioritize secure connection methods (SSH with proper key validation, WinRM over HTTPS) for any sensitive or production systems.**

## Ansible Tips & Best Practices

* **Idempotency**: Design your roles and tasks to be idempotent. This means a task can be run multiple times, but it will only make changes if the system is not already in the desired state.
* **Ansible Vault**: Use Ansible Vault to encrypt sensitive data like passwords, API keys, and private certificates. **Never store sensitive data in plain text** in your playbooks or variable files.
    * Create an encrypted file: `ansible-vault create group_vars/all/vault.yml`
    * Edit an encrypted file: `ansible-vault edit group_vars/all/vault.yml`
    * Run playbook with vault: `ansible-playbook playbooks/main.yml --ask-vault-pass`
* **Check Mode (`--check`)**: Always use `--check` before applying changes to production or critical systems.
* **Verbosity (`-v`, `-vv`, `-vvv`)**: Increase verbosity to get more detailed output for debugging issues.
* **Official Ansible Documentation**: This is your most valuable resource: [docs.ansible.com](https://docs.ansible.com/).
* **Ansible Galaxy**: Explore [galaxy.ansible.com](https://galaxy.ansible.com/) for pre-built roles from the community, which can save you significant development time.
* **Linting**: Use tools like `ansible-lint` to check your playbooks and roles for best practices and potential errors.

## Contributing

Contributions to this scaffolding script are welcome! If you have suggestions for improvements, new features, or find any bugs, please follow these steps:

1.  **Fork the repository.**
2.  **Create a new branch** for your feature or bug fix:
    ```bash
    git checkout -b feature/your-awesome-feature
    ```
    or
    ```bash
    git checkout -b fix/bug-description
    ```
3.  **Make your changes** and commit them with clear, descriptive messages.
4.  **Push your changes** to your fork:
    ```bash
    git push origin feature/your-awesome-feature
    ```
5.  **Open a Pull Request** against the `main` (or `master`) branch of the original repository.

Please ensure your code adheres to the existing style and that your changes are well-tested if possible. You can also open an issue to discuss potential changes or report bugs.

## License

This project is licensed under the MIT License - see the `LICENSE` file for details.
(Note: You would need to create a `LICENSE` file in your repository, typically containing the MIT License text.)

---

Happy Automating!
